<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8"/>
    <meta
      name="viewport"
      content="width=device-width,
               initial-scale=1.0"
    />
    <meta name="description" content="Interactive housing affordability calculator for Spain"/>
    <title>
      Housing Affordability ‚Äì Multi-Location Comparator (v3.3)
    </title>
    <link rel="icon" href="data:,"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="style.css"/>
    <link rel="stylesheet" href="jsvectormap/jsvectormap.min.css"/>
    <style>
      :root {
        --bg: #121212;
        --panel: #1e1e1e;
        --accent: #3b82f6;
        --text: #e5e5e5;
        --good: #22c55e;
        --bad: #ef4444;
      }
      :root[data-theme="light"] {
        --bg: #f5f5f5;
        --panel: #ffffff;
        --accent: #3b82f6;
        --text: #222222;
        --good: #16a34a;
        --bad: #dc2626;
      }
      body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: var(--bg);
        color: var(--text);
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
      }
      h1 {
        margin-bottom: 10px;
        font-size: 1.4rem;
        text-align: center;
      }
      .wrap {
        display: grid;
        grid-template-columns: 320px 1fr;
        gap: 20px;
        width: 100%;
        max-width: min(1200px, 90vw);
        margin: 0 auto;
      }
      details {
        margin-bottom: 10px;
      }
      summary {
        cursor: pointer;
        font-weight: 600;
        margin: 8px 0;
      }
      select,
      input[type="number"],
      input[type="range"],
      button {
        width: 100%;
        padding: 6px;
        border-radius: 4px;
        border: 1px solid #333;
        background: #0f0f0f;
        color: var(--text);
      }
      label {
        font-size: 0.85rem;
        display: block;
        margin: 8px 0 4px;
      }
      .panel {
        background: var(--panel);
        padding: 20px;
        border-radius: 8px;
      }
      .result {
        margin-top: 10px;
        font-weight: 600;
      }
      .curve-editor {
        width: 100%;
        max-height: 120px;
        margin-top: 4px;
      }
      .hidden {
        display: none;
      }
      .chart-container {
        padding: 30px;
        margin-top: 20px;
      }
      .chart-container canvas {
        display: block;
        width: 100%;
        max-width: 700px;
        margin: 0 auto;
        padding: 10px;
      }
      .chart-container table {
        width: 100%;
        margin-top: 10px;
        font-size: 0.8rem;
        table-layout: fixed;
      }
      .chart-container th,
      .chart-container td {
        text-align: center;
      }
      canvas {
        background: #0f0f0f;
        border-radius: 6px;
      }
    </style>
    <script src="chart.umd.js"></script>
    <link rel="stylesheet" href="jsvectormap/jsvectormap.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js">
    </script>
  </head>
  <body>
    <h1>Housing Affordability ‚Äì Compare Locations</h1>
    <button id="themeToggle" style="margin-bottom:10px;">Toggle theme</button>
    <div class="wrap">
      <div class="panel">
        <details>
          <summary>Ubicaci√≥n</summary>
          <label>
            Locations (Ctrl/Cmd + click to multi-select)
          </label>
          <select id="loc" multiple size="14">
          <optgroup label="Centro">
            <option value="grupo_Centro">
              Centro (grupo)
            </option>
            <option>La Latina</option>
            <option>Lavapi√©s</option>
            <option>Malasa√±a</option>
          </optgroup>
          <optgroup label="Periferia municipal">
            <option value="grupo_PeriferiaMunicipal">
              Periferia municipal (grupo)
            </option>
            <option>San Isidro</option>
            <option>Embajadores</option>
            <option>Barajas</option>
          </optgroup>
          <optgroup label="Periferia provincial">
            <option value="grupo_PeriferiaProvincial">
              Periferia provincial (grupo)
            </option>
            <option>Segovia</option>
            <option>Guadalajara</option>
          </optgroup>
          <optgroup label="Sierra Madrid">
            <option value="grupo_SierraMadrid">
              Sierra Madrid (grupo)
            </option>
            <option>Becerril</option>
            <option>Navacerrada</option>
          </optgroup>
          <optgroup label="Costa Andaluza">
            <option value="grupo_CostaAndaluza">
              Costa Andaluza (grupo)
            </option>
            <option>Costa Andaluza</option>
          </optgroup>
          <optgroup label="Almer√≠a">
            <option value="grupo_Almeria">
              Almer√≠a (grupo)
            </option>
            <option value="Centro Almer√≠a">Centro Almer√≠a</option>
            <option value="Retamar">Retamar</option>
            <option value="Aguadulce">Aguadulce</option>
            <option value="Roquetas de Mar">Roquetas de Mar</option>
          </optgroup>
          <optgroup label="Canarias">
            <option value="grupo_Canarias">
              Canarias (grupo)
            </option>
            <option>Lanzarote</option>
            <option>La Palma</option>
            <option>Tenerife</option>
            <option>Gran Canaria</option>
          </optgroup>
          <optgroup label="Provincias">
            <option>√Ålava</option>
            <option>Albacete</option>
            <option>Alicante</option>
            <option>Almer√≠a</option>
            <option>Asturias</option>
            <option>√Åvila</option>
            <option>Badajoz</option>
            <option>Barcelona</option>
            <option>Burgos</option>
            <option>C√°ceres</option>
            <option>C√°diz</option>
            <option>Cantabria</option>
            <option>Castell√≥n</option>
            <option>Ciudad Real</option>
            <option>C√≥rdoba</option>
            <option>Cuenca</option>
            <option>Girona</option>
            <option>Granada</option>
            <option>Guadalajara</option>
            <option>Guip√∫zcoa</option>
            <option>Huelva</option>
            <option>Huesca</option>
            <option>Illes Balears</option>
            <option>Ja√©n</option>
            <option>La Coru√±a</option>
            <option>La Rioja</option>
            <option>Las Palmas</option>
            <option>Le√≥n</option>
            <option>Lleida</option>
            <option>Lugo</option>
            <option>Madrid</option>
            <option>M√°laga</option>
            <option>Murcia</option>
            <option>Navarra</option>
            <option>Ourense</option>
            <option>Palencia</option>
            <option>Pontevedra</option>
            <option>Salamanca</option>
            <option>Santa Cruz de Tenerife</option>
            <option>Segovia</option>
            <option>Sevilla</option>
            <option>Soria</option>
            <option>Tarragona</option>
            <option>Teruel</option>
            <option>Toledo</option>
            <option>Valencia</option>
            <option>Valladolid</option>
            <option>Vizcaya</option>
            <option>Zamora</option>
            <option>Zaragoza</option>
            <option>Ceuta</option>
          <option>Melilla</option>
        </optgroup>
        </select>
      </details>

        <details>
          <summary>Trabajo y compra</summary>
          <label>A√±o de cambio de empleo</label>
          <input
            id="changeYear"
            type="number"
            value="2028"
            min="2025"
            max="2100"
          />

          <label>Trayectoria tras cambio</label>
          <select id="newCareer">
            <option value="stay">‚è≥ Seguir en empresa actual</option>
            <option value="odoo">üöÄ Cambiar a otro partner Odoo</option>
            <option value="ai">ü§ñ Pivotar a IA/Python</option>
          </select>

          <label>
            Years until purchase:
            <span id="yrsLabel">2</span>
          </label>
          <input
            id="yrs"
            type="range"
            min="1"
            max="15"
            value="2"
          />

          <label>Start year</label>
          <input
            id="startYear"
            type="number"
            value="2025"
            min="2020"
            max="2100"
          />
        </details>

        <details>
          <summary>Vivienda</summary>
          <label>Dwelling size (m¬≤)</label>
          <input
            id="size"
            type="number"
            value="80"
            min="30"
            max="300"
          />

          <label>Tipo de vivienda</label>
          <select id="dwellingType">
            <option value="piso">Piso</option>
            <option value="chalet">Chalet</option>
            <option value="atico">√Åtico</option>
          </select>

          <label>Habitaciones</label>
          <input
            id="rooms"
            type="number"
            value="3"
            min="1"
            max="10"
          />

          <label>Extras</label>
          <div id="extras">
            <label><input id="garden" type="checkbox" /> Jard√≠n</label>
            <label><input id="terrace" type="checkbox" /> Terraza</label>
            <label><input id="patio" type="checkbox" /> Patio</label>
            <label><input id="basement" type="checkbox" /> S√≥tano</label>
          </div>
        </details>

        <label>Tipo de salario</label>
        <select id="salaryType">
          <option value="net">Neto mensual</option>
          <option value="gross">Bruto anual</option>
        </select>
    <details>
      <summary>Finanzas personales</summary>
      <div id="netField">
        <label id="netLabel">Starting net salary (‚Ç¨/month)</label>
        <input id="salary" type="number" value="1450" />
      </div>
      <div id="grossFields" style="display:none">
        <label>Gross salary per year (‚Ç¨)</label>
        <input id="gross" type="number" value="25000" />
        <label>Pay periods</label>
        <input id="periods" type="number" value="12" />
        <label>IRPF (%)</label>
        <select id="irpf">
          <option value="15">15%</option>
          <option value="20">20%</option>
          <option value="25">25%</option>
          <option value="30">30%</option>
        </select>
      </div>
      <label>Savings rate (%)</label>
      <canvas id="saveCurve" class="curve-editor"></canvas>
      <label><input id="useExpense" type="checkbox" /> Usar gasto fijo</label>
      <label>Gasto mensual (‚Ç¨)</label>
      <canvas id="expenseCurve" class="curve-editor hidden"></canvas>
      <label>Expected annual return on savings (%)</label>
      <input id="ret" type="number" value="2" step="0.1" min="0" max="10" />
      <label>Long-term inflation floor (%)</label>
      <input id="inflFloor" type="number" value="2" step="0.1" min="0" max="5" />
    </details>

        <details>
          <summary>Escenario y m√©tricas</summary>
          <label>Market scenario</label>
          <select id="scenario">
            <option value="base">
              Base (hist√≥rico)
            </option>
            <option value="optimistic">
              Optimista (IPC +1 %)
            </option>
            <option value="pessimistic">
              Pesimista (pico hist√≥rico)
            </option>
          </select>

          <label>Career path</label>
          <select id="career">
            <option value="stay">
              ‚è≥ Seguir en empresa actual
            </option>
            <option value="odoo">
              üöÄ Cambiar a otro partner Odoo
            </option>
            <option value="ai">
              ü§ñ Pivotar a IA/Python
            </option>
          </select>

          <label>Property metric</label>
          <select id="propMetric">
            <option value="price">
              üè† Precio vivienda
            </option>
            <option value="down">
              üí∞ Entrada 20%
            </option>
            <option value="mortgage">
              üìà Cuota hipoteca
            </option>
          </select>

        <label>Personal metric</label>
        <select id="persMetric">
          <option value="savings">
            üí∏ Ahorros acumulados
          </option>
          <option value="monthlySavings">
            üíπ Ahorro mensual
          </option>
          <option value="salary">
            ü™ô Salario neto mensual
          </option>
          <option value="ratio">
            üìä A√±os de salario
          </option>
        </select>
        </details>

        <details>
          <summary>Hipoteca</summary>
          <label>Initial savings (‚Ç¨)</label>
          <input
            id="initSavings"
            type="number"
            value="3000"
            step="100"
            min="0"
          />

          <label>Mortgage rate (%)</label>
          <input
            id="mortRate"
            type="number"
            value="3"
            step="0.1"
            min="0"
            max="10"
          />

          <label>Mortgage term (years)</label>
          <input
            id="mortYears"
            type="number"
            value="30"
            min="5"
            max="40"
          />

          <label>Down payment (%)</label>
          <input
            id="downPct"
            type="number"
            value="20"
            step="1"
            min="5"
            max="60"
          />
        </details>

        <button
          id="reset"
          style="margin-top: 8px;"
        >
          Reset
        </button>
        <button
          id="exportCsv"
          style="margin-top: 8px;"
        >
          Download CSV
        </button>

        <div class="result" id="summary"></div>
        <p
          style="font-size:0.7rem;
                 opacity:0.7;
                 margin-top:10px;"
        >
          Precios: Idealista 05/2025 ¬∑
          Salarios: Glassdoor 2024-25
        </p>
      </div>

      <div class="panel chart-container">
        <canvas id="chart" height="300"></canvas>
        <div id="matches"></div>
      </div>
    </div>

  <script src="provinces.js"></script>
  <script>
    if (
      "serviceWorker" in navigator &&
      window.location.protocol.startsWith("http")
    ) {
      navigator.serviceWorker.register("sw.js").catch(() => {
        console.log("Service worker registration failed");
      });
    }
  </script>
  <script src="main.js"></script>
  </body>
</html>
